(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6626)}])},6626:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return o},default:function(){return c}});var l=n(5893),s=n(7294);function i(e){let{src:t,poster:n,onPlay:i}=e,a=(0,s.useRef)(null),[r,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>m(e.currentTime/(e.duration||1)*100);return e.addEventListener("timeupdate",t),()=>e.removeEventListener("timeupdate",t)},[]),(0,s.useEffect)(()=>{let e=e=>{if("Space"===e.code||" "===e.key){let t=document.fullscreenElement;if(!t)return;let n=a.current;n&&(t===n||t===n.parentElement||n.parentElement&&n.parentElement.contains(t))&&(e.preventDefault(),n.paused?(n.play(),o(!0),i&&i()):(n.pause(),o(!1)))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,l.jsxs)("div",{className:"player",children:[(0,l.jsx)("video",{ref:a,src:t,poster:n,className:"player-video",preload:"metadata"}),(0,l.jsxs)("div",{className:"player-controls",children:[(0,l.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;e&&(e.paused?(e.play(),o(!0),i&&i()):(e.pause(),o(!1)))},children:r?"❚❚":"▶"}),(0,l.jsx)("div",{className:"player-progress",onClick:function(e){let t=a.current;if(!t)return;let n=e.target.getBoundingClientRect(),l=(e.clientX-n.left)/n.width;t.currentTime=(t.duration||0)*l},role:"progressbar",children:(0,l.jsx)("div",{className:"player-progress-bar",style:{width:"".concat(u,"%")}})}),(0,l.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;e&&(e.loop=!e.loop,d(e.loop))},children:c?"\uD83D\uDD01":"↻"}),(0,l.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;if(!e)return;let t=e.parentElement||e;t.requestFullscreen&&t.requestFullscreen()},children:"⤢"})]})]})}function a(e){let{videoId:t,currentUser:n}=e,[i,a]=(0,s.useState)([]),[r,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(!0);async function u(){let e=localStorage.getItem("token");if(!e)return alert("Connectez-vous");if(!r.trim())return;let n=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json","x-token":e},body:JSON.stringify({videoId:t,text:r})});if(n.ok){let e=await n.json();a(t=>[...t,e]),o("")}}async function m(e){let n=localStorage.getItem("token");if(!n||!confirm("Supprimer ce commentaire ?"))return;let l=await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json","x-token":n},body:JSON.stringify({videoId:t,commentId:e})});l.ok&&a(t=>t.filter(t=>t.id!==e))}if((0,s.useEffect)(()=>{fetch("/api/comments?videoId=".concat(encodeURIComponent(t))).then(e=>e.json()).then(a).catch(()=>a([])).finally(()=>d(!1))},[t]),c)return null;let p=localStorage.getItem("username");return p?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{marginBottom:8},children:[(0,l.jsx)("textarea",{value:r,onChange:e=>o(e.target.value),placeholder:"\xc9crire un commentaire...",style:{width:"100%",minHeight:60,padding:8,borderRadius:8}}),(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:(0,l.jsx)("button",{onClick:u,className:"btn-ghost",children:"Publier"})})]}),(0,l.jsxs)("div",{children:[0===i.length&&(0,l.jsx)("div",{className:"small",children:"Aucun commentaire"}),i.map(e=>(0,l.jsxs)("div",{style:{padding:"8px 0",borderBottom:"1px solid var(--muted-bg)"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("strong",{children:e.author}),(0,l.jsx)("div",{className:"small",children:new Date(e.createdAt).toLocaleString()})]}),(0,l.jsx)("div",{style:{marginTop:6},children:e.text}),e.author===p&&(0,l.jsx)("div",{style:{marginTop:6},children:(0,l.jsx)("button",{onClick:()=>m(e.id),className:"btn-ghost",children:"Supprimer"})})]},e.id))]})]}):(0,l.jsx)("div",{className:"small",children:"Connectez-vous pour voir et poster des commentaires."})}var r=n(1163),o=!0;function c(e){let{staticVideos:t,staticFolders:n}=e,[o,c]=(0,s.useState)(t),[d,u]=(0,s.useState)(!0),[m,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)({}),[f,x]=(0,s.useState)({}),[y,j]=(0,s.useState)(""),[v,b]=(0,s.useState)(n),[S,k]=(0,s.useState)(""),N=(0,r.useRouter)(),[C,w]=(0,s.useState)(localStorage.getItem("theme")||"light"),[E,I]=(0,s.useState)(localStorage.getItem("lang")||"fr");async function T(e){try{let t=await fetch("/api/view",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.ok){let n=await t.json();c(t=>t.map(t=>t.id===e?{...t,views:n.views}:t))}}catch(e){}}async function _(e){try{let t=!!localStorage.getItem("liked_"+e);if(t){let t=await fetch("/api/unlike",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.ok){let n=await t.json();c(t=>t.map(t=>t.id===e?{...t,likes:n.likes}:t)),localStorage.removeItem("liked_"+e)}}else{let t=await fetch("/api/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.ok){let n=await t.json();c(t=>t.map(t=>t.id===e?{...t,likes:n.likes}:t)),localStorage.setItem("liked_"+e,"1")}}}catch(e){}}(0,s.useEffect)(()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add("dark"===C?"dark":"light"),localStorage.setItem("theme",C),localStorage.setItem("lang",E),document.documentElement.dir="ar"===E?"rtl":"ltr"},[C,E]),(0,s.useEffect)(()=>{t&&n&&(c(t),b(n),u(!1))},[t,n]);let L=(y||"").trim().toLowerCase(),O=o.filter(e=>{if(S&&(!e.url||!(e.url.includes("/uploads/")&&e.url.includes(S))))return!1;if(!L)return!0;let t=String(e.title||""),n=String(e.description||"");return t.toLowerCase().includes(L)||n.toLowerCase().includes(L)});return d?(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("h1",{children:"Loading..."})}):(0,l.jsxs)("div",{className:"container",children:[(0,l.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,l.jsx)("img",{src:"/Untitled-1.svg",alt:"logo",style:{width:40,height:40}}),(0,l.jsx)("h1",{style:{margin:0},children:"lissafa top"})]}),(0,l.jsxs)("div",{className:"nav",children:[(0,l.jsxs)("select",{value:E,onChange:e=>I(e.target.value),style:{padding:8,borderRadius:8},children:[(0,l.jsx)("option",{value:"fr",children:"FR"}),(0,l.jsx)("option",{value:"ar",children:"AR"})]}),(0,l.jsx)("button",{onClick:()=>w(e=>"dark"===e?"light":"dark"),className:"btn-ghost",style:{marginLeft:8},children:"dark"===C?"☀️":"\uD83C\uDF19"}),m&&(0,l.jsx)("a",{href:"/admin",style:{marginRight:12,marginLeft:12},children:"Admin"}),(0,l.jsx)("button",{onClick:function(){localStorage.removeItem("token"),localStorage.removeItem("username"),N.push("/login")},className:"btn-ghost",children:"D\xe9connexion"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,marginTop:12},children:[(0,l.jsx)("h2",{style:{margin:0},children:"Vid\xe9os"}),(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,l.jsx)("input",{placeholder:"Search videos...",value:y,onChange:e=>j(e.target.value),style:{padding:8,borderRadius:8,border:"1px solid var(--muted-bg)"}}),(0,l.jsxs)("select",{value:S,onChange:e=>k(e.target.value),style:{padding:8,borderRadius:8},children:[(0,l.jsx)("option",{value:"",children:"All folders"}),v.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]})]}),v.length>0&&(0,l.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,flexWrap:"wrap"},children:[v.map(e=>(0,l.jsx)("button",{className:e===S?"btn-primary":"btn-outline",onClick:()=>k(e),style:{padding:"6px 10px"},children:e},e)),S&&(0,l.jsx)("button",{className:"btn-ghost",onClick:()=>k(""),children:"Clear"})]}),0===O.length&&(0,l.jsx)("p",{className:"small",children:"No videos found."}),O.map(e=>{let t=Array.isArray(e.title)?e.title[0]:e.title||"";return(0,l.jsx)("div",{className:"video-item",children:(0,l.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,l.jsxs)("div",{style:{position:"relative"},children:[e.thumbnail?(0,l.jsx)("img",{src:e.thumbnail,className:"thumb",alt:t,loading:"lazy"}):(0,l.jsx)("div",{className:"thumb",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:t}),!f[e.id]&&e.url&&e.url.endsWith(".mp4")&&(0,l.jsx)("button",{onClick:()=>x(t=>({...t,[e.id]:!0})),className:"player-btn",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"},children:"Play"})]}),(0,l.jsxs)("div",{style:{flex:1},children:[f[e.id]&&e.url&&e.url.endsWith(".mp4")&&(0,l.jsx)(i,{src:e.url,poster:e.thumbnail||void 0,onPlay:()=>T(e.id)}),(0,l.jsx)("div",{style:{marginTop:8},children:(0,l.jsx)("strong",{children:t})}),e.description&&(0,l.jsx)("div",{className:"small",style:{marginTop:6},children:e.description}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[(0,l.jsxs)("div",{className:"small",children:["Vues : ",e.views||0]}),(0,l.jsxs)("div",{className:"small",children:["Likes : ",e.likes||0]}),(0,l.jsx)("button",{onClick:()=>_(e.id),className:"player-btn",children:"❤"})]}),e.uploadedBy&&(0,l.jsxs)("div",{className:"small",children:["Publi\xe9 par : ",e.uploadedBy]}),(0,l.jsxs)("div",{style:{marginTop:10},children:[(0,l.jsx)("button",{className:"btn-ghost",onClick:()=>g(t=>({...t,[e.id]:!t[e.id]})),children:h[e.id]?"Hide comments":"Show comments"}),h[e.id]&&(0,l.jsx)("div",{style:{marginTop:8},children:(0,l.jsx)(a,{videoId:e.id,currentUser:localStorage.getItem("username")})})]})]})]})},e.id)})]})}},1163:function(e,t,n){e.exports=n(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);